{% extends "posts/base.html" %}
{% block content %}
    {% load staticfiles %}
    {# Flash messages #}
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
    {% endif %}

    <div class="row">
        <div class="ag_post_article_detail col-md-10 col-md-offset-1 col-xs-10 col-xs-offset-1">
            <div class="row">
                <div class="ag_article_header col-xs-8 col-xs-offset-2 col-md-8 col-md-offset-2">
                    <div class="ag_article_name_poster">
                        <a href="{% url "profiles:user_profile" username=user.username %}">
                            <div class="ag_article_avatar_image_user">
                                <div class="ag_article_div_image" style="{% if instance.user.profile.avatar %}background-image: url('{{ instance.user.profile.avatar.url }}');{% else %}background-image: url('{% static 'posts/img/favicon/fav.png' %}');{% endif %}"></div>
                            </div>
                            {{ instance.user.get_full_name|title }}
                        </a>
                    </div>
                    <h1>{{ instance.title }}</h1>
                    <div class="ag_article_header_pub_date">
                        <div class="ag_article_timestamps">
                            <small class="ag_pub_date">Publicado {{ instance.created|date:"M d, Y" }}</small>
                            <small class="ag_upadted_at">Última actualización {{ instance.updated|date:"M d, Y" }}</small>
                        </div>
                    </div>
                </div>
            </div>

            {% if instance.image %}
                <div class="row">
                    <div class="ag_article_image_wrapper col-xs-8 col-xs-offset-2 col-md-8 col-md-offset-2">
                        <a href="{{ instance.image.url }}" class="progressive replace">
                            <img src="{{ instance.image.url }}" class="preview" alt="image" />
                        </a>
                        <!-- <img class="ag_article_img img-small" src="{{ instance.image.url }}" alt="Post detail image" /> -->
                    </div>
                </div>
            {% endif %}

            <div class="row">
                <div class="ag_article_content_wrapper col-xs-8 col-xs-offset-2 col-md-8 col-md-offset-2">
                    {{ instance.content|safe }}
                </div>
            </div>

            <!-- FORM FOR COMMENTS -->
            <div class="row">
                <div class="ag_article_comments_wrapper col-xs-8 col-xs-offset-2 col-md-8 col-md-offset-2">
                    <div class="ag_comments_container">
                        <div class="article_comments_thread">
                            <!-- HEAD -->
                            <div class="article_comments_header">
                                <img src="{% static 'posts/img/icons/comment.png' %}" alt="Post comments image" />
                                {% with comments.count as total_comments %}
                                    {% if total_comments == 0 %}
                                        Sé el primero en compartir tu opinión
                                    {% else %}
                                        {{ total_comments }} Comentario{{ total_comments|pluralize }}
                                    {% endif %}
                                {% endwith %}
                            </div>

                            <!-- FORM -->
                            <div class="article_reply_form">
                                <div class="reply_form_avatar">
                                    <div class="reply_form_avatar_image" style="{% if instance.user.profile.avatar %}background-image: url('{{ instance.user.profile.avatar.url }}');{% else %}background-image: url('{% static 'posts/img/favicon/fav.png' %}');{% endif %}">
                                    </div>
                                </div>
                                <div class="reply_form_inputs">
                                    <form method="post">
                                        {% csrf_token %}
                                        <textarea name="contenido" id="id_contenido" required="" placeholder="Deja un comentario" rows="2" maxlength="300"></textarea>

                                        <div class="reply_footer">
                                            <div class="footer_hint">La longitud máxima del comentario es de 300 caracteres</div>
                                            <div class="footer_actions">
                                                <input class="footer_input_subm disabled_input" type="submit" value="Enviar" />
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <!-- USER COMMENTS -->
                            
                            <form method="post">{% csrf_token %}
                                {{ comment_form }}
                                <input type="submit" />
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DISPLAY COMMENTS -->
            <div class="row">
                {% with comments.count as total_comments %}
                    <h2>
                        {{ total_comments }} comment{{ total_comments|pluralize }}
                    </h2>
                {% endwith %}

                {% for comment in comments %}
                    <div class="comment">
                        <p class="info">
                            Comment {{ forloop.counter }} by {{ comment.user.username }}
                            {{ comment.created }}
                        </p>
                        {{ comment.contenido|linebreaks }}
                    </div>
                {% empty %}
                    <p>There are no comments yet.</p>
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}

{% block js %}
    <script>
        $(document).ready(function(){
            $("#id_contenido")
                .click(function() {
                    $(".reply_footer").show();
                    $(".reply_footer").css( "display", "flex" );
                })
                /*.blur(function(){
                    $(".reply_footer").hide();
                })*/
                .keyup(function() {
                    var count = $(this).val().length;
                    count > 0 ? $( ".footer_input_subm" ).removeClass( "disabled_input" ) : $( ".footer_input_subm" ).addClass( "disabled_input" )
            });
        });
    </script>
{% endblock %}